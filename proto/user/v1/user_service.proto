syntax = "proto3";

package user.v1;

option go_package = "github.com/tam/tam-protos/gen/go/user/v1;userv1";

// UserService handles authentication, user management, and session management
service UserService {
    // Authenticate user and create session
    rpc Login(LoginRequest) returns (LoginResponse);

    // Validate a session token
    rpc ValidateSession(ValidateSessionRequest) returns (ValidateSessionResponse);

    // Get session information
    rpc GetSession(GetSessionRequest) returns (GetSessionResponse);

    // Refresh a session (extend TTL)
    rpc RefreshSession(RefreshSessionRequest) returns (RefreshSessionResponse);

    // Create a new session
    rpc CreateSession(CreateSessionRequest) returns (CreateSessionResponse);
}

// Request to authenticate user
message LoginRequest {
    string email = 1;
    string password = 2;
    string ip = 3;          // Client IP address
    string user_agent = 4;  // Client user agent
}

// Response with authentication token
message LoginResponse {
    string token = 1;       // Session token (JWT)
    User user = 2;          // User profile information
}

// User profile information
message User {
    string id = 1;
    string email = 2;
    string name = 3;
    string created_at = 4;
    string updated_at = 5;
}

// Request to validate a session token
message ValidateSessionRequest {
    string token = 1;
}

// Response with session validation result
message ValidateSessionResponse {
    bool valid = 1;
    string user_id = 2;     // Present if valid
}

// Request to get session information
message GetSessionRequest {
    string token = 1;
}

// Response with session information
message GetSessionResponse {
    Session session = 1;
}

// Session information
message Session {
    string id = 1;
    string user_id = 2;
    string created_at = 3;
    string expires_at = 4;
}

// Request to refresh a session
message RefreshSessionRequest {
    string token = 1;
}

// Response from refreshing session
message RefreshSessionResponse {
    string status = 1;      // e.g., "refreshed"
}

// Request to create a new session
message CreateSessionRequest {
    string user_id = 1;
    string ip = 2;
    string user_agent = 3;
}

// Response with new session
message CreateSessionResponse {
    Session session = 1;
}
